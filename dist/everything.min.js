var playersMap={},movesHistoryMap={},gameLogic;!function(a){function b(){playersMap[0]="R",playersMap[1]="G",playersMap[2]="Y"}function c(a){return playersMap[a]}function d(a,b,c,d){var e=a+"_"+b+"_"+c+"_"+d;return movesHistoryMap[e]}function e(){movesHistoryMap={}}function f(a){switch(a){case 2:return[["#","#","#","#","#","#","#","#","#","","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","","","","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","","","","","","#","#","#","#","#","#","#"],["","","","","","","","","","","","","G","","G","","G","","G"],["#","","","","","","","","","","","","","G","","G","","G","#"],["#","#","","","","","","","","","","","","","G","","G","#","#"],["#","#","#","","","","","","","","","","","","","G","#","#","#"],["#","#","","","","","","","","","","","","","","","","#","#"],["#","","","","","","","","","","","","","","","","","","#"],["","","","","","","R","","R","","R","","R","","","","","",""],["#","#","#","#","#","#","#","R","","R","","R","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","R","","R","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","R","#","#","#","#","#","#","#","#","#"]];case 3:return[["#","#","#","#","#","#","#","#","#","","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","","","","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","","","","","","#","#","#","#","#","#","#"],["Y","","Y","","Y","","Y","","","","","","G","","G","","G","","G"],["#","Y","","Y","","Y","","","","","","","","G","","G","","G","#"],["#","#","Y","","Y","","","","","","","","","","G","","G","#","#"],["#","#","#","Y","","","","","","","","","","","","G","#","#","#"],["#","#","","","","","","","","","","","","","","","","#","#"],["#","","","","","","","","","","","","","","","","","","#"],["","","","","","","R","","R","","R","","R","","","","","",""],["#","#","#","#","#","#","#","R","","R","","R","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","R","","R","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","R","#","#","#","#","#","#","#","#","#"]];default:throw new Error("illegal Player Number: expect 2 or 3")}}function g(a){for(var b="",c=0;c<a.length;c++)for(var d=0;d<a[0].length;d++){var e=a[c][d];b+=""===e?" ":e}var f=["#########R#################R R###############R R R#######. . . R R R R . . .#. . . . . . . . .###. . . . . . . .#####. . . . . . .#####. . . . . . . .###. . . . . . . . .#. . . . . . . . . .#######. . .###############. .#################.#########","#########.#################. .###############. . .#######. . . . . . . . . .#. . . . . . . . .###. . . . . . . .#####G . . . . . .#####G G . . . . . .###G G G . . . . . .#G G G G . . . . . .#######. . .###############. .#################.#########","#########.#################. .###############. . .#######. . . . . . . . . .#. . . . . . . . .###. . . . . . . .#####. . . . . . Y#####. . . . . . Y Y###. . . . . . Y Y Y#. . . . . . Y Y Y Y#######. . .###############. .#################.#########"];for(c=0;c<f.length;c++){var g=f[c],h=new RegExp(g);if(h.test(b))return playersMap[c]}return""}function h(a,b,c){for(var d=[],e=[[0,-2],[-1,-1],[-1,1],[0,2],[1,-1],[1,1]],f=angular.copy(a),g=0;g<e.length;g++){var h=c.rowS+e[g][0],l=c.colS+e[g][1],m={rowS:c.rowS,colS:c.colS,rowE:h,colE:l,playerNo:c.playerNo};try{j([m]),d.push(n(a,b,m)),k(f,h,l)}catch(o){}}try{var p=i(a,f,e,b,[c],c.rowS,c.colS);p&&d.push.apply(d,p)}catch(o){}return d}function i(a,b,c,d,e,f,g){for(var h=[],m=e.length-1,o=e[m].rowE,p=e[m].colE,q=0;q<c.length;q++){var r=o+c[q][0],s=p+c[q][1];try{if(l(a,r,s)){var t=o+2*c[q][0],u=p+2*c[q][1],v={rowS:f,colS:g,rowE:t,colE:u,playerNo:e[m].playerNo},w=n(b,d,v);if(w){h.push(w);var x=angular.copy(e);x.push({rowS:o,colS:p,rowE:t,colE:u,playerNo:e[m].playerNo}),j(x),k(b,t,u);var y=i(a,b,c,d,x,f,g);y.length>0&&h.push.apply(h,y)}}}catch(z){}}return h}function j(a){if(0!=a.length){var b=a[0].rowS,c=a[0].colS,d=a[a.length-1].rowE,e=a[a.length-1].colE,f=b+"_"+c+"_"+d+"_"+e,g=movesHistoryMap[f];if(!(g&&g.length<=a.length)){var h=angular.copy(a);h.length>1&&h.splice(0,1),movesHistoryMap[f]=h}}}function k(a,b,c){a[b][c]="@"}function l(a,b,c){return"R"===a[b][c]||"G"===a[b][c]||"Y"===a[b][c]?!0:!1}function m(a,b,c){for(var d=angular.copy(a),e=0;e<a.length;e++)for(var f=0;f<a[0].length;f++)d[e][f]===b&&(d[e][f]=c);return d}function n(a,c,d){if(!a)throw new Error("Board doesn't initial normally");playersMap[c]||b();var e=d.rowS,f=d.colS,h=d.rowE,i=d.colE,j=d.playerNo;if(0>e||0>f||e>=a.length||f>=a[0].length||0>h||0>i||h>=a.length||i>=a[0].length||"#"===a[e][f]||"#"===a[h][i])throw new Error("Exceed board range");if((e+f)%2===0||(h+i)%2===0)throw new Error("Not a valid position");if(""!==a[h][i])throw new Error("One can only make a move in an empty position!");if(""!==g(a))throw new Error("Can only make a move if the game is not over!");var k=m(a,"@","");k[e][f]="",k[h][i]=playersMap[c];var l,n=g(k);return l=""!==n?2===j?{endMatch:{endMatchScores:[n===playersMap[0]?1:0,n===playersMap[1]?1:0]}}:{endMatch:{endMatchScores:[n===playersMap[0]?1:0,n===playersMap[1]?1:0,n===playersMap[2]?1:0]}}:{setTurn:{turnIndex:(c+1)%j}},[l,{set:{key:"board",value:k}},{set:{key:"delta",value:d}}]}function o(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,g=d.board;g||(g=f(e.playerNo));var h=(e.playerNo,n(g,c,e));if(!angular.equals(b,h))return console.log("isMoveOk inValidMove!! Move is not the same with expected! move="+JSON.stringify(b)+" expectedMove="+JSON.stringify(h)),console.log("isMoveOK movesHistoryMap="+JSON.stringify(movesHistoryMap)),!1}catch(i){return console.log("isMoveOk inValidMove!! error"+i),!1}return!0}a.initialPLayersMap=b,a.getPlayerColorById=c,a.getMovesHistory=d,a.clearMoveHistory=e,a.getInitialBoard=f,a.getPossibleMoves=h,a.getPossibleJumpMoves=i,a.createMove=n,a.isMoveOk=o}(gameLogic||(gameLogic={}));var game;!function(a){function b(){resizeGameAreaService.setWidthToHeight(1),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:3,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1),J=document.getElementById("gameArea"),dragAndDropService.addDragListener("gameArea",q),gameLogic.initialPLayersMap()}function c(){$rootScope.$apply(function(){log.info("Animation ended"),A=!0,gameLogic.clearMoveHistory(),C&&d()})}function d(){gameService.makeMove(aiService.findComputerMove(D))}function e(a){console.log("updateUI[0]",angular.toJson(a)),A=!1,D=a,H=a.playersInfo.length,E=a.stateAfterMove,E.board||(E.board=gameLogic.getInitialBoard(H)),I=a.turnIndexAfterMove,console.log("updateUI[1] playerId="+I),console.log("params.playMode="+a.playMode),E.delta&&"passAndPlay"!=a.playMode&&p(E.delta),B=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,C=B&&""===a.playersInfo[a.yourPlayerIndex].playerId,C&&(B=!1,E.delta||d())}function f(a,b){return"R"===E.board[a][b]}function g(a,b){return"G"===E.board[a][b]}function h(a,b){return"Y"===E.board[a][b]}function i(){return new Array(13)}function j(){return new Array(19)}function k(a,b){var c={rowS:a,colS:b,rowE:a,colE:b,playerNo:H};return l(a,b,I,c)}function l(a,b,c,d){return E.board[a][b]!==gameLogic.getPlayerColorById(c)?!1:(G=gameLogic.getPossibleMoves(E.board,c,d),0==G.length?!1:!0)}function m(a,b){return E.delta&&E.delta.rowE===a&&E.delta.colE===b&&"passAndPlay"!=D.playMode?{top:"10%",left:"0%",position:"relative",width:"80%",height:"80%",margin:"auto",zIndex:"100","-webkit-animation":"moveAnimation 1s",animation:"moveAnimation 1s"}:{top:"10%",left:"0%",position:"relative",width:"80%",height:"80%",margin:"auto"}}function n(a){return 7.72*a}function o(a){return 4.427*a+5.5}function p(a){var b=gameLogic.getMovesHistory(a.rowS,a.colS,a.rowE,a.colE);if(b||(b=[E.delta]),b){console.log("modifyMoveCSS  moveHistory="+JSON.stringify(b));for(var c=b.length,d=b[b.length-1].rowE,e=b[b.length-1].colE,f="",g=100/c,h=0;c>h;h++){var i=100*(b[h].rowS-d)+10,j=100*(b[h].colS-e)/2;f+=g*h+"% {top: "+i+"%; left: "+j+"%;}"}console.log("modifyMoveCSS  cssRules="+f);var k=document.createElement("style");k.type="text/css",k.innerHTML=" @-webkit-keyframes moveAnimation { "+f+" }",document.getElementsByTagName("head")[0].appendChild(k);var l=document.createElement("style");l.type="text/css",l.innerHTML=" @keyframes moveAnimation { "+f+" }",document.getElementsByTagName("head")[0].appendChild(l)}}function q(a,b,c){var d,e,f=b-J.offsetLeft,g=c-J.offsetTop;if(0>f||0>g||f>=J.clientWidth||g>=J.clientHeight){if(!N)return;var h=0,i=0;0>g&&(h=0),g>=J.clientHeight&&(h=K-1),0>f&&(i=0),f>=J.clientWidth&&(i=L-1),y(h,i,!1)}else{var j=D.turnIndexAfterMove,d=Math.floor(g/J.clientHeight*100/7.72),e=0;if(e=d%2===0?2*Math.floor((f/J.clientWidth*100-9.927)/8.854)+1:2*Math.floor((f/J.clientWidth*100-5.5)/8.854),"touchstart"===a){var m={rowS:d,colS:e,rowE:d,colE:e,playerNo:H};l(d,e,j,m)&&(F={row:d,col:e}),M||k(d,e)&&(M={row:d,col:e},N=document.getElementById("cell_"+M.row+"_"+M.col),N.style.zIndex=++O+"",t())}if(!N)return;if("touchend"===a){var n=M,o={row:d,col:e};r(n,o)}else y(d,e,!1)}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&M&&(y(M.row,M.col,!0),M=null,x(),N=null)}function r(a,b){var c="Dragged piece "+a.row+"x"+a.col+" to square "+b.row+"x"+b.col;if(log.info(c),c=c,a.row!==b.row||a.col!==b.col){x();try{var d=D.turnIndexAfterMove;gameLogic.getMovesHistory(a.row,a.col,b.row,b.col)&&(y(a.row,a.col,!0),s(b.row,b.col,d))}catch(e){}}}function s(a,b,c){var d={rowS:F.row,colS:F.col,rowE:a,colE:b,playerNo:H},e=gameLogic.createMove(E.board,c,d);F=null,M=null,N=null,B=!1,console.log("game.ts commitTheMove move= "+JSON.stringify(e)),gameService.makeMove(e)}function t(){N.className.indexOf("selected")<0&&(N.className+=" selected")}function u(){N.className.indexOf("canDrop")<0&&(N.className+=" canDrop")}function v(){N.className=N.className.replace("selected","")}function w(){N.className=N.className.replace("canDrop","")}function x(){v(),w()}function y(a,b,c){if(!gameLogic.getMovesHistory(M.row,M.col,a,b)||M.row===a&&M.col===b?w():u(),c||!z(a,b))return N.style.left=o(M.col)+"%",void(N.style.top="0%");n(M.row);N.style.left=o(b)+"%",N.style.top=100*(a-M.row)+"%"}function z(a,b){return"#"!=E.board[a][b]&&(a+b)%2===1?!0:!1}var A=!1,B=!1,C=!1,D=null,E=null;a.isHelpModalShown=!1;var F=null,G=[],H=0,I=-1,J=null,K=13,L=19,M=null,N=null,O=61;a.init=b,a.updateUI=e,a.isPieceRed=f,a.isPieceGreen=g,a.isPieceYellow=h,a.getBoardRow=i,a.getBoardCol=j,a.isSelectableAt=k,a.getStyle=m}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_DIAMOND_GAME:"Rules of Diamond Game",RULES_SLIDE1:"You and your opponent take turns to move your own piece. The first player's piece is red, second is green, third is yellow",RULES_SLIDE2:"You can move your piece to an adjancent empty position",RULES_SLIDE3:"Or jump over any other pieces for any consecutive jump steps",RULES_SLIDE4:"The first to put all pieces into the other end of board wins.",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a){return c(a.stateAfterMove.board,m,a.numberOfPlayers,a.turnIndexAfterMove)}function c(a,b,c,e){return d(a,b,c,e)}function d(a,b,c,d){gameLogic.initialPLayersMap();var h=0,i=null,m=[],n=j(a,d),o=[];o=e(a,m,n,b,c,d);for(var p=0,q=0;q<o.length;q++){for(var r=0,s=(o[q].board,o[q].deltaList),t=0,u=0;u<s.length;u++){var v=s[u];0===u&&(t=l(v.rowS,v.colS,d));var w=k(v.rowS,v.colS,v.rowE,v.colE,d);r+=w}(null===i||r>h||r===h&&t>p)&&(h=r,i=s[0],p=t)}if(0==h&&f(n,d)){var x=g(a,n,d,c);if(x)return x}var y=gameLogic.createMove(a,d,i);return console.log("myMove="+JSON.stringify(y)),y}function e(a,b,c,d,f,g){if(0==d)return[{board:a,deltaList:angular.copy(b)}];for(var h=[],i=0;i<c.length;i++)for(var j=c[i][0],l=c[i][1],m=gameLogic.getPossibleMoves(a,g,{rowS:j,colS:l,rowE:j,colE:l,playerNo:f}),n=0;n<m.length;n++){var o=m[n],p=o[1].set.value,q=o[2].set.value;if(void 0!=o[0].endMatch)return b.push(q),[{board:a,deltaList:angular.copy(b)}];if(!(k(q.rowS,q.colS,q.rowE,q.colE,g)<0)){var r=angular.copy(c);r.splice(i,1),r.push([q.rowE,q.colE]);var s=angular.copy(b);s.push(q);var t=e(p,s,r,d-1,f,g);t&&h.push.apply(h,t)}}return h}function f(a,b){for(var c=0,d=0;d<a.length;d++)c+=l(a[d][0],a[d][1],b);return 25>c?!0:!1}function g(a,b,c,d){var e=h(b,c),f=i(a,c);if(!f)return null;for(var j=gameLogic.getPossibleMoves(a,c,{rowS:e[0],colS:e[1],rowE:e[0],colE:e[1],playerNo:d}),k=null,l=30,m=0;m<j.length;m++){var n=j[m],o=n[2].set.value,p=Math.abs(parseInt(o.rowE)-f[0])+Math.abs(parseInt(o.colE)-f[1]);l>p&&(k=n,l=p)}return console.log("getEndGameMove bestMove="+JSON.stringify(g)),k}function h(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=l(a[e][0],a[e][1],b);f>3&&f>d&&(c=a[e],d=f)}return c}function i(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<a[0].length;e++)if(l(d,e,b)<=3&&""===a[d][e])return c=[d,e]}function j(a,b){for(var c=playersMap[b],d=[],e=0;e<a.length;e++)for(var f=0;f<a[0].length;f++)a[e][f]==c&&d.push([e,f]);return d}function k(a,b,c,d,e){var f=parseInt(n[e][a][b]),g=parseInt(n[e][c][d]);return f-g}function l(a,b,c){try{return parseInt(n[c][a][b])}catch(d){return 13}}var m=1;a.findComputerMove=b,a.createComputerMove=c;var n=[[["#","#","#","#","#","#","#","#","#","0","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","1","","1","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","2","","2","","2","#","#","#","#","#","#","#"],["9","","7","","5","","3","","3","","3","","3","","5","","7","","9"],["#","8","","6","","5","","4","","4","","4","","5","","6","","8","#"],["#","#","7","","6","","5","","5","","5","","5","","6","","7","#","#"],["#","#","#","7","","6","","6","","6","","6","","6","","7","#","#","#"],["#","#","8","","7","","7","","7","","7","","7","","7","","8","#","#"],["#","10","","9","","8","","8","","8","","8","","8","","9","","10","#"],["12","","11","","10","","9","","9","","9","","9","","10","","11","","12"],["#","#","#","#","#","#","#","10","","10","","10","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","11","","11","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","12","#","#","#","#","#","#","#","#","#"]],[["#","#","#","#","#","#","#","#","#","12","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","10","","11","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","8","","9","","10","#","#","#","#","#","#","#"],["9","","8","","7","","7","","7","","8","","9","","10","","11","","12"],["#","7","","6","","6","","6","","7","","8","","9","","10","","11","#"],["#","#","5","","5","","5","","6","","7","","8","","9","","10","#","#"],["#","#","#","3","","4","","5","","6","","7","","8","","9","#","#","#"],["#","#","2","","3","","4","","5","","6","","7","","8","","10","#","#"],["#","1","","2","","3","","4","","5","","6","","7","","9","","11","#"],["0","","1","","2","","3","","5","","6","","7","","8","","10","","12"],["#","#","#","#","#","#","#","5","","6","","7","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","7","","8","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","9","#","#","#","#","#","#","#","#","#"]],[["#","#","#","#","#","#","#","#","#","12","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","11","","10","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","10","","9","","8","#","#","#","#","#","#","#"],["12","","11","","10","","9","","8","","7","","7","","7","","8","","9"],["#","11","","10","","9","","8","","7","","6","","6","","6","","7","#"],["#","#","10","","9","","8","","7","","6","","5","","5","","5","#","#"],["#","#","#","9","","8","","7","","6","","5","","4","","3","#","#","#"],["#","#","10","","8","","7","","6","","5","","4","","3","","2","#","#"],["#","11","","9","","7","","6","","5","","4","","3","","2","","1","#"],["12","","10","","8","","7","","6","","5","","3","","2","","1","","0"],["#","#","#","#","#","#","#","7","","6","","5","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","8","","7","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","9","#","#","#","#","#","#","#","#","#"]]]}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map