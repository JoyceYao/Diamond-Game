var playersMap={},movesHistoryMap={},gameLogic;!function(a){function b(){playersMap[0]="R",playersMap[1]="G",playersMap[2]="Y"}function c(a){return playersMap[a]}function d(a,b,c,d){var e=a+"_"+b+"_"+c+"_"+d;return movesHistoryMap[e]}function e(){movesHistoryMap={}}function f(a){switch(a){case 2:return[["#","#","#","#","#","#","#","#","#","","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","","","","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","","","","","","#","#","#","#","#","#","#"],["","","","","","","","","","","","","G","","G","","G","","G"],["#","","","","","","","","","","","","","G","","G","","G","#"],["#","#","","","","","","","","","","","","","G","","G","#","#"],["#","#","#","","","","","","","","","","","","","G","#","#","#"],["#","#","","","","","","","","","","","","","","","","#","#"],["#","","","","","","","","","","","","","","","","","","#"],["","","","","","","R","","R","","R","","R","","","","","",""],["#","#","#","#","#","#","#","R","","R","","R","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","R","","R","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","R","#","#","#","#","#","#","#","#","#"]];case 3:return[["#","#","#","#","#","#","#","#","#","","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","","","","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","","","","","","#","#","#","#","#","#","#"],["Y","","Y","","Y","","Y","","","","","","G","","G","","G","","G"],["#","Y","","Y","","Y","","","","","","","","G","","G","","G","#"],["#","#","Y","","Y","","","","","","","","","","G","","G","#","#"],["#","#","#","Y","","","","","","","","","","","","G","#","#","#"],["#","#","","","","","","","","","","","","","","","","#","#"],["#","","","","","","","","","","","","","","","","","","#"],["","","","","","","R","","R","","R","","R","","","","","",""],["#","#","#","#","#","#","#","R","","R","","R","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","R","","R","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","R","#","#","#","#","#","#","#","#","#"]];default:throw new Error("illegal Player Number: expect 2 or 3")}}function g(a){for(var b="",c=0;c<a.length;c++)for(var d=0;d<a[0].length;d++){var e=a[c][d];b+=""===e?" ":e}var f=["#########R#################R R###############R R R#######. . . R R R R . . .#. . . . . . . . .###. . . . . . . .#####. . . . . . .#####. . . . . . . .###. . . . . . . . .#. . . . . . . . . .#######. . .###############. .#################.#########","#########.#################. .###############. . .#######. . . . . . . . . .#. . . . . . . . .###. . . . . . . .#####G . . . . . .#####G G . . . . . .###G G G . . . . . .#G G G G . . . . . .#######. . .###############. .#################.#########","#########.#################. .###############. . .#######. . . . . . . . . .#. . . . . . . . .###. . . . . . . .#####. . . . . . Y#####. . . . . . Y Y###. . . . . . Y Y Y#. . . . . . Y Y Y Y#######. . .###############. .#################.#########"];for(c=0;c<f.length;c++){var g=f[c],h=new RegExp(g);if(h.test(b))return playersMap[c]}return""}function h(a,b,c){for(var d=[],e=[[0,-2],[-1,-1],[-1,1],[0,2],[1,-1],[1,1]],f=angular.copy(a),g=0;g<e.length;g++){var h=c.rowS+e[g][0],l=c.colS+e[g][1],m={rowS:c.rowS,colS:c.colS,rowE:h,colE:l,playerNo:c.playerNo};try{d.push(n(a,b,m)),j([m]),k(f,h,l)}catch(o){}}try{var p=i(a,f,e,b,[c],c.rowS,c.colS);p&&d.push.apply(d,p)}catch(o){}return d}function i(a,b,c,d,e,f,g){for(var h=[],m=e.length-1,o=e[m].rowE,p=e[m].colE,q=0;q<c.length;q++){var r=o+c[q][0],s=p+c[q][1];try{if(l(a,r,s)){var t=o+2*c[q][0],u=p+2*c[q][1],v={rowS:f,colS:g,rowE:t,colE:u,playerNo:e[m].playerNo},w=n(b,d,v);if(w){h.push(w);var x=angular.copy(e);x.push({rowS:o,colS:p,rowE:t,colE:u,playerNo:e[m].playerNo}),j(x),k(b,t,u);var y=i(a,b,c,d,x,f,g);y.length>0&&h.push.apply(h,y)}}}catch(z){}}return h}function j(a){if(0!=a.length){var b=a[0].rowS,c=a[0].colS,d=a[a.length-1].rowE,e=a[a.length-1].colE,f=b+"_"+c+"_"+d+"_"+e,g=movesHistoryMap[f];if(!(g&&g.length<=a.length)){var h=angular.copy(a);h.length>1&&h.splice(0,1),movesHistoryMap[f]=h}}}function k(a,b,c){a[b][c]="@"}function l(a,b,c){return"R"===a[b][c]||"G"===a[b][c]||"Y"===a[b][c]?!0:!1}function m(a,b,c){for(var d=angular.copy(a),e=0;e<a.length;e++)for(var f=0;f<a[0].length;f++)d[e][f]===b&&(d[e][f]=c);return d}function n(a,b,c){if(!a)throw new Error("Board doesn't initial normally");var d=c.rowS,e=c.colS,f=c.rowE,h=c.colE,i=c.playerNo;if(0>d||0>e||d>=a.length||e>=a[0].length||0>f||0>h||f>=a.length||h>=a[0].length||"#"===a[d][e]||"#"===a[f][h])throw new Error("Exceed board range");if((d+e)%2===0||(f+h)%2===0)throw new Error("Not a valid position");if(""!==a[f][h])throw new Error("One can only make a move in an empty position!");if(""!==g(a))throw new Error("Can only make a move if the game is not over!");var j=m(a,"@","");j[d][e]="",j[f][h]=playersMap[b];var k,l=g(j);return k=""!==l?2===i?{endMatch:{endMatchScores:[l===playersMap[0]?1:0,l===playersMap[1]?1:0]}}:{endMatch:{endMatchScores:[l===playersMap[0]?1:0,l===playersMap[1]?1:0,l===playersMap[2]?1:0]}}:{setTurn:{turnIndex:(b+1)%i}},[k,{set:{key:"board",value:j}},{set:{key:"delta",value:c}}]}function o(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,g=d.board;g||(g=f(e.playerNo));var h=(e.playerNo,n(g,c,e));if(!angular.equals(b,h))return!1}catch(i){return!1}return!0}a.initialPLayersMap=b,a.getPlayerColorById=c,a.getMovesHistory=d,a.clearMoveHistory=e,a.getInitialBoard=f,a.getPossibleMoves=h,a.getPossibleJumpMoves=i,a.createMove=n,a.isMoveOk=o}(gameLogic||(gameLogic={}));var game;!function(a){function b(){resizeGameAreaService.setWidthToHeight(1),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:3,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1),E=document.getElementById("gameArea"),console.log("gameArea="+JSON.stringify(E)),dragAndDropService.addDragListener("gameArea",q),gameLogic.initialPLayersMap()}function c(){$rootScope.$apply(function(){log.info("Animation ended"),v=!0,gameLogic.clearMoveHistory(),x&&d()})}function d(){gameService.makeMove(aiService.findComputerMove(y))}function e(a){console.log("updateUI[0]",angular.toJson(a)),v=!1,y=a,C=a.playersInfo.length,z=a.stateAfterMove,z.board||(z.board=gameLogic.getInitialBoard(C)),D=a.turnIndexAfterMove,console.log("updateUI[1] playerId="+D),console.log("params.playMode="+a.playMode),z.delta&&"passAndPlay"!=a.playMode&&p(z.delta),w=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,x=w&&""===a.playersInfo[a.yourPlayerIndex].playerId,x&&(w=!1,d())}function f(a,b){return"R"===z.board[a][b]}function g(a,b){return"G"===z.board[a][b]}function h(a,b){return"Y"===z.board[a][b]}function i(){return new Array(13)}function j(){return new Array(19)}function k(a,b){var c=null;return c=z&&z.delta?z.delta:{rowS:a,colS:b,rowE:a,colE:b,playerNo:C},l(a,b,D,c)}function l(a,b,c,d){return z.board[a][b]!==gameLogic.getPlayerColorById(c)?!1:(B=gameLogic.getPossibleMoves(z.board,c,d),0==B.length?!1:!0)}function m(a,b){return z.delta&&z.delta.rowE===a&&z.delta.colE===b?{top:"0%",left:"0%",position:"relative",width:"90%",height:"100%","-webkit-animation":"moveAnimation 1s",animation:"moveAnimation 1s"}:{width:"90%",height:"100%"}}function n(a){return 7.86*a}function o(a){return 4.59*a+5.5}function p(a){var b=gameLogic.getMovesHistory(a.rowS,a.colS,a.rowE,a.colE);if(b){for(var c=b.length,d=b[b.length-1].rowE,e=b[b.length-1].colE,f="",g=100/c,h=0;c>h;h++){var i=100*(b[h].rowS-d),j=100*(b[h].colS-e)/2;f+=g*h+"% {top: "+i+"%; left: "+j+"%;}"}var k=document.createElement("style");k.type="text/css",k.innerHTML=" @-webkit-keyframes moveAnimation { "+f+" }",document.getElementsByTagName("head")[0].appendChild(k);var l=document.createElement("style");l.type="text/css",l.innerHTML=" @keyframes moveAnimation { "+f+" }",document.getElementsByTagName("head")[0].appendChild(l)}}function q(a,b,c){var d,e,f=b-E.offsetLeft,g=c-E.offsetTop;if(0>f||0>g||f>=E.clientWidth||g>=E.clientHeight){if(!I)return;var h=0,i=0;0>g&&(h=0),g>=E.clientHeight&&(h=F-1),0>f&&(i=0),f>=E.clientWidth&&(i=G-1),t(h,i,!1)}else{var j=y.turnIndexAfterMove,d=Math.floor(g/E.clientHeight*100/7.86),e=0;if(e=d%2===0?2*Math.floor((f/E.clientWidth*100-5.5)/9.18)+1:2*Math.floor((f/E.clientWidth*100-5.5)/9.18),"touchstart"===a){var m={rowS:d,colS:e,rowE:d,colE:e,playerNo:C};l(d,e,j,m)&&(A={row:d,col:e}),H||k(d,e)&&(H={row:d,col:e},I=document.getElementById("piece_"+H.row+"_"+H.col),I.style.zIndex=++K+"",I.className+=" selected",J=document.getElementById("cell_"+H.row+"_"+H.col),J.className+=" selected")}if(!I)return;if("touchend"===a){var n=H,o={row:d,col:e};r(n,o)}else t(d,e,!1)}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&H&&(t(H.row,H.col,!0),H=null,I.className=I.className.replace("selected",""),J.className=J.className.replace("selected",""),I=null)}function r(a,b){var c="Dragged piece "+a.row+"x"+a.col+" to square "+b.row+"x"+b.col;if(log.info(c),c=c,a.row!==b.row||a.col!==b.col){I.className=I.className.replace("selected",""),J.className=J.className.replace("selected","");try{var d=y.turnIndexAfterMove;gameLogic.getMovesHistory(a.row,a.col,b.row,b.col)&&(t(a.row,a.col,!0),s(b.row,b.col,d))}catch(e){}}}function s(a,b,c){var d={rowS:A.row,colS:A.col,rowE:a,colE:b,playerNo:C},e=gameLogic.createMove(z.board,c,d);A=null,H=null,I=null,w=!1,gameService.makeMove(e)}function t(a,b,c){if(c||!u(a,b))return I.style.left=o(H.col)+"%",void(I.style.top="0%");n(H.row);I.style.left=o(b)+"%",I.style.top=100*(a-H.row)+"%"}function u(a,b){return"#"!=z.board[a][b]&&(a+b)%2===1?!0:!1}var v=!1,w=!1,x=!1,y=null,z=null;a.isHelpModalShown=!1;var A=null,B=[],C=0,D=-1,E=null,F=13,G=19,H=null,I=null,J=null,K=61;a.init=b,a.updateUI=e,a.isPieceRed=f,a.isPieceGreen=g,a.isPieceYellow=h,a.getBoardRow=i,a.getBoardCol=j,a.isSelectableAt=k,a.getStyle=m}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_DIAMOND_GAME:"Rules of Diamond Game",RULES_SLIDE1:"You and your opponent take turns to move your own piece. The first player's piece is red, second is green, third is yellow",RULES_SLIDE2:"You can move your piece to an adjancent empty position",RULES_SLIDE3:"Or jump over any other pieces for any consecutive jump steps",RULES_SLIDE4:"The first to put all pieces into the other end of board wins.",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a){return c(a.stateAfterMove.board,h,a.numberOfPlayers,a.turnIndexAfterMove)}function c(a,b,c,e){return d(a,b,c,e)}function d(a,b,c,d){gameLogic.initialPLayersMap();for(var h=0,i=null,j=[],k=f(a,d),l=e(a,j,k,b,c,d),m=0;m<l.length;m++){for(var n=0,o=(l[m].board,l[m].deltaList),p=0;p<o.length;p++){var q=o[p],r=g(q.rowS,q.colS,q.rowE,q.colE,d);n+=r}(null===i||n>h)&&(h=n,i=o[0])}var s=gameLogic.createMove(a,d,i);return s}function e(a,b,c,d,f,h){if(0==d)return[{board:a,deltaList:angular.copy(b)}];for(var i=[],j=0;j<c.length;j++)for(var k=c[j][0],l=c[j][1],m=gameLogic.getPossibleMoves(a,h,{rowS:k,colS:l,rowE:k,colE:l,playerNo:f}),n=0;n<m.length;n++){var o=m[n],p=o[1].set.value,q=o[2].set.value;if(void 0!=o[0].endMatch)return b.push(q),[{board:a,deltaList:angular.copy(b)}];if(!(g(q.rowS,q.colS,q.rowE,q.colE,h)<0)){var r=angular.copy(c);r.splice(j,1),r.push([q.rowE,q.colE]),b.push(q);var s=e(p,b,r,d-1,f,h);s&&i.push.apply(i,s),b.splice(-1,1)}}return i}function f(a,b){for(var c=playersMap[b],d=[],e=0;e<a.length;e++)for(var f=0;f<a[0].length;f++)a[e][f]==c&&d.push([e,f]);return d}function g(a,b,c,d,e){var f=parseInt(i[e][a][b]),g=parseInt(i[e][c][d]);return f-g}var h=1;a.findComputerMove=b,a.createComputerMove=c;var i=[[["#","#","#","#","#","#","#","#","#","0","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","1","","1","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","2","","2","","2","#","#","#","#","#","#","#"],["9","","7","","5","","3","","3","","3","","3","","5","","7","","9"],["#","8","","6","","5","","4","","4","","4","","5","","6","","8","#"],["#","#","7","","6","","5","","5","","5","","5","","6","","7","#","#"],["#","#","#","7","","6","","6","","6","","6","","6","","7","#","#","#"],["#","#","8","","7","","7","","7","","7","","7","","7","","8","#","#"],["#","10","","9","","8","","8","","8","","8","","8","","9","","10","#"],["12","","11","","10","","9","","9","","9","","9","","10","","11","","12"],["#","#","#","#","#","#","#","10","","10","","10","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","11","","11","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","12","#","#","#","#","#","#","#","#","#"]],[["#","#","#","#","#","#","#","#","#","12","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","10","","11","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","8","","9","","10","#","#","#","#","#","#","#"],["9","","8","","7","","6","","7","","8","","9","","10","","11","","12"],["#","7","","6","","5","","6","","7","","8","","9","","10","","11","#"],["#","#","5","","5","","5","","6","","7","","8","","9","","10","#","#"],["#","#","#","3","","4","","5","","6","","7","","8","","9","#","#","#"],["#","#","2","","3","","4","","5","","6","","7","","8","","10","#","#"],["#","1","","2","","3","","4","","5","","6","","7","","9","","11","#"],["0","","1","","2","","3","","5","","6","","6","","8","","10","","12"],["#","#","#","#","#","#","#","5","","6","","7","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","7","","8","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","9","#","#","#","#","#","#","#","#","#"]],[["#","#","#","#","#","#","#","#","#","12","#","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","11","","10","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","10","","9","","8","#","#","#","#","#","#","#"],["12","","11","","10","","9","","8","","7","","6","","7","","8","","9"],["#","11","","10","","9","","8","","7","","6","","6","","6","","7","#"],["#","#","10","","9","","8","","7","","6","","5","","5","","5","#","#"],["#","#","#","9","","8","","7","","6","","5","","4","","3","#","#","#"],["#","#","10","","8","","7","","6","","5","","4","","3","","2","#","#"],["#","11","","9","","7","","6","","5","","4","","3","","2","","1","#"],["12","","10","","8","","6","","6","","5","","3","","2","","1","","0"],["#","#","#","#","#","#","#","7","","6","","5","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","8","","7","#","#","#","#","#","#","#","#"],["#","#","#","#","#","#","#","#","#","9","#","#","#","#","#","#","#","#","#"]]]}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map